# Last Updated:
# Author: Wesley Cai
# Purpose:
library(data.table)
library(ggplot2)
library(ggvenn)
# OG: Google_Drive/medschool/research/qin/chip/analysis/210516_overlaps/210518_overlaps_H3K9me3_KDM5B_SETDB1_updated.R
mainwd <- "."
outputfolder <- "output/"
dir.create(file.path(mainwd, outputfolder), recursive = TRUE, showWarnings = FALSE)
setwd(file.path(mainwd, outputfolder))
repmask.rna.dict <- fread("../../dat/mm10.repmask.rna.dict.txt")
# File can be found at GSE161065
repmask.rna.dict <- fread("/Users/wcai/Google_Drive/medschool/research/qin/resources/mm10.repmask.rna.dict.txt")
library(showtext)
font_add("Arial", "/Applications/Microsoft Word.app/Contents/Resources/DFonts/arial.ttf")
showtext_auto()
#### TE stats ####
multi.repmask.file <- "../../dat/YR-H3K9me3.YR-KDM5B.YR-SETDB1.common.repmask.bed"
multi.repmask <- fread(multi.repmask.file)
multi.repmask[, repmask.name := paste0(V8, "_", V5, "-", V6, "-", V7)]
multi.repmask.merge <- merge(multi.repmask, repmask.rna.dict, by = "repmask.name")
multi.repmask.merge.te <- multi.repmask.merge[final.type %in% c("DNA", "LTR", "SINE", "LINE")]
multi.repmask.merge.te[, final.type := factor(final.type, c("LTR", "LINE", "SINE", "DNA"))]
mp <- ggplot(multi.repmask.merge.te[rna.padj.unique < 0.05], aes(final.type, rna.l2fc.unique)) +
geom_hline(yintercept = 0, linetype="dashed", color = "gray") +
geom_boxplot(width = 0.5, aes(fill = final.type), show.legend = F) +
geom_jitter(width = 0.1, alpha = 0.5) +
ylab(label = expression("RNA "*Log[2]*"(FC)")) +
# ylim(c(-8, 15)) +
scale_fill_discrete(name = "RE type") +
theme_bw() +
theme(axis.text.y = element_text(size = 14, color = "black"),
axis.text.x = element_text(size = 16, color = "black"),
axis.title = element_text(size = 16),
axis.title.x = element_blank(),
panel.grid = element_blank(),
panel.border = element_rect(fill=NA, colour = "black", size=1),
text=element_text(family="Arial"))
mp
p.table <- data.table(final.type = c("DNA", "LTR", "LINE", "SINE"))
multi.repmask.merge.te.sig <- multi.repmask.merge.te[rna.padj.unique < 0.05]
for(rown in 1:nrow(p.table)){
final.type.var <- p.table[rown, get("final.type")]
p.table[rown, sig.up := nrow(multi.repmask.merge.te.sig[final.type == final.type.var & rna.l2fc.unique > 0])]
p.table[rown, sig.down := nrow(multi.repmask.merge.te.sig[final.type == final.type.var & rna.l2fc.unique < 0])]
p.table[rown, LTR.mann.whitney.p.value := wilcox.test(multi.repmask.merge.te.sig[final.type == "LTR", get("rna.l2fc.unique")],
multi.repmask.merge.te.sig[final.type == final.type.var, get("rna.l2fc.unique")])$p.value]
p.table[rown, LTR.t.test.p.value := t.test(multi.repmask.merge.te.sig[final.type == "LTR", get("rna.l2fc.unique")],
multi.repmask.merge.te.sig[final.type == final.type.var, get("rna.l2fc.unique")])$p.value]
}
#### Venn diagrams ####
yr.setdb1.file <- "/Users/wcai/Google_Drive/medschool/research/qin/chip/peaks/macs/chip.merge/anyoverlap/YR-SETDB1_merge.bed"
yr.kdm5b.file <- "/Users/wcai/Google_Drive/medschool/research/qin/chip/peaks/macs/chip.merge/anyoverlap/YR-KDM5B_merge.bed"
yr.h3k9me3.file <- "/Users/wcai/Google_Drive/medschool/research/qin/chip/peaks/macs/chip.merge/anyoverlap/YR-H3K9me3_merge.bed"
mult.int.bed.file <- "temp.mult.int.bed"
